/*! formstone v0.8.35 [background.js] 2015-12-28 | MIT License | formstone.it */!function(b,d){"use strict";function z(){q.iterate.call(t,x)}function r(){t=b(g.base)}function w(c){c.youTubeGuid=0,c.$container=b('<div class="'+a.container+'"></div>').appendTo(this),this.addClass([a.base,c.customClass].join(" "));var d=c.source;c.source=null,s(c,d,!0),r()}function v(b){b.$container.remove(),this.removeClass([a.base,b.customClass].join(" ")).off(c.namespace),r()}function s(a,d,k){var g,l,h,e,j,f;if(d!==a.source)if(a.source=d,a.responsive=!1,a.isYouTube=!1,"object"===b.type(d)&&"string"===b.type(d.video)&&(g=d.video.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i),g&&g.length>=1&&(a.isYouTube=!0,a.videoId=g[1])),l=!a.isYouTube&&"object"===b.type(d)&&(d.hasOwnProperty("mp4")||d.hasOwnProperty("ogg")||d.hasOwnProperty("webm")),a.video=a.isYouTube||l,a.playing=!1,a.isYouTube)a.playerReady=!1,a.posterLoaded=!1,m(a,d,k);else if("object"===b.type(d)&&d.hasOwnProperty("poster"))C(a,d,k);else{if(h=d,"object"===b.type(d)){j=[],f=[];for(e in d)d.hasOwnProperty(e)&&f.push(e);f.sort(q.sortAsc);for(e in f)f.hasOwnProperty(e)&&j.push({width:parseInt(f[e]),url:d[f[e]],mq:window.matchMedia("(min-width: "+parseInt(f[e])+"px)")});a.responsive=!0,a.sources=j,h=p(a)}i(a,h,!1,k)}else a.$el.trigger(c.loaded)}function p(a){var c=a.source,b;if(a.responsive){c=a.sources[0].url;for(b in a.sources)a.sources.hasOwnProperty(b)&&(d.support.nativeMatchMedia?a.sources[b].mq.matches&&(c=a.sources[b].url):a.sources[b].width<d.fallbackWidth&&(c=a.sources[b].url))}return c}function i(d,m,i,j){var l=[a.media,a.image,j!==!0?a.animated:""].join(" "),f=b('<div class="'+l+'"><img></div>'),g=f.find("img"),h=m;g.one(c.load,function(){n&&f.addClass(a.native).css({backgroundImage:"url('"+h+"')"}),f.fsTransition({property:"opacity"},function(){i||k(d)}).css({opacity:1}),e(d),(!i||j)&&d.$el.trigger(c.loaded)}).attr("src",h),d.responsive&&f.addClass(a.responsive),d.$container.append(f),(g[0].complete||4===g[0].readyState)&&g.trigger(c.load),d.currentSource=h}function C(f,n,j){var l,g,h,m;f.source&&f.source.poster&&(i(f,f.source.poster,!0,!0),j=!1),!d.isMobile&&(l=[a.media,a.video,j!==!0?a.animated:""].join(" "),g='<div class="'+l+'">',g+="<video",f.loop&&(g+=" loop"),f.mute&&(g+=" muted"),g+=">",f.source.webm&&(g+='<source src="'+f.source.webm+'" type="video/webm" />'),f.source.mp4&&(g+='<source src="'+f.source.mp4+'" type="video/mp4" />'),f.source.ogg&&(g+='<source src="'+f.source.ogg+'" type="video/ogg" />'),g+="</video>",g+="</div>",h=b(g),m=h.find("video"),m.one(c.loadedMetaData,function(){h.fsTransition({property:"opacity"},function(){k(f)}).css({opacity:1}),e(f),f.$el.trigger(c.loaded),f.autoPlay&&o(f)}),f.$container.append(h))}function m(j,s,p){var q,m,r,n,o,t;j.videoId||(q=s.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/),j.videoId=q[1]),(j.posterLoaded||(j.source.poster||(j.source.poster="//img.youtube.com/vi/"+j.videoId+"/0.jpg"),j.posterLoaded=!0,i(j,j.source.poster,!0,p),p=!1),!d.isMobile)&&(b("script[src*='youtube.com/iframe_api']").length||b("head").append('<script src="//www.youtube.com/iframe_api"><\/script>'),l?(m=j.guid+"_"+j.youTubeGuid++,r=[a.media,a.embed,p!==!0?a.animated:""].join(" "),n='<div class="'+r+'">',n+='<div id="'+m+'"></div>',n+="</div>",o=b(n),t=b.extend(!0,{},{controls:0,rel:0,showinfo:0,wmode:"transparent",enablejsapi:1,version:3,playerapiid:m,loop:j.loop?1:0,autoplay:1,origin:f.location.protocol+"//"+f.location.host},j.youtubeOptions),j.$container.append(o),j.player&&(j.oldPlayer=j.player,j.player=null),j.player=new f.YT.Player(m,{videoId:j.videoId,playerVars:t,events:{onReady:function(){j.playerReady=!0,j.mute&&j.player.mute(),j.autoPlay&&j.player.playVideo()},onStateChange:function(b){j.playing||b.data!==f.YT.PlayerState.PLAYING?j.loop&&j.playing&&b.data===f.YT.PlayerState.ENDED&&j.player.playVideo():(j.playing=!0,j.autoPlay||j.player.pauseVideo(),o.fsTransition({property:"opacity"},function(){k(j)}).css({opacity:1}),e(j),j.$el.trigger(c.loaded)),j.$el.find(g.embed).addClass(a.ready)},onPlaybackQualityChange:function(){},onPlaybackRateChange:function(){},onError:function(){},onApiChange:function(){}}}),e(j)):h.push({data:j,source:s}))}function k(a){var b=a.$container.find(g.media);b.length>=1&&(b.not(":last").remove(),a.oldPlayer=null)}function B(b){var a=b.$container.find(g.media);a.length>=1&&a.fsTransition({property:"opacity"},function(){a.remove(),delete b.source}).css({opacity:0})}function A(a){if(a.video){if(a.isYouTube&&a.playerReady)a.player.pauseVideo();else{var b=a.$container.find("video");b.length&&b[0].pause()}a.playing=!1}}function o(a){if(a.video){if(a.isYouTube&&a.playerReady)a.player.playVideo();else{var b=a.$container.find("video");b.length&&b[0].play()}a.playing=!0}}function D(a){if(a.video){if(a.isYouTube&&a.playerReady)a.player.mute();else{var b=a.$container.find("video");b.length&&(b[0].muted=!0)}a.playing=!0}a.mute=!0}function y(a){if(a.video){if(a.isYouTube&&a.playerReady)a.player.unMute();else{var b=a.$container.find("video");b.length&&(b[0].muted=!1)}a.playing=!0}a.mute=!1}function x(a){if(a.responsive){var b=p(a);b!==a.currentSource?i(a,b,!1,!0):e(a)}else e(a)}function e(a){for(var i=a.$container.find(g.media),c=0,l=i.length,d,f,h,b,j,e,k;l>c;c++)d=i.eq(c),f=a.isYouTube?"iframe":d.find("video").length?"video":"img",h=d.find(f),h.length&&("img"!==f||!n)&&(b=a.$el.outerWidth(),j=a.$el.outerHeight(),e=u(a,h),a.width=e.width,a.height=e.height,a.left=0,a.top=0,k=a.isYouTube?a.embedRatio:a.width/a.height,a.height=j,a.width=a.height*k,a.width<b&&(a.width=b,a.height=a.width/k),a.left=-(a.width-b)/2,a.top=-(a.height-j)/2,d.css({height:a.height,width:a.width,left:a.left,top:a.top}))}function u(e,c){var a,d;return e.isYouTube?{height:500,width:500/e.embedRatio}:c.is("img")?(a=c[0],"undefined"!==b.type(a.naturalHeight))?{height:a.naturalHeight,width:a.naturalWidth}:(d=new Image,d.src=a.src,{height:d.height,width:d.width}):{height:c[0].videoHeight,width:c[0].videoWidth}}var j=d.Plugin("background",{widget:!0,defaults:{autoPlay:!0,customClass:"",embedRatio:1.777777,loop:!0,mute:!0,source:null,youtubeOptions:{}},classes:["container","media","animated","responsive","native","fixed","ready"],events:{loaded:"loaded",ready:"ready",loadedMetaData:"loadedmetadata"},methods:{_construct:w,_destruct:v,_resize:z,play:o,pause:A,mute:D,unmute:y,resize:e,load:s,unload:B}}),g=j.classes,a=g.raw,c=j.events,q=j.functions,f=d.window,t=[],n="backgroundSize"in d.document.documentElement.style,l=!1,h=[];f.onYouTubeIframeAPIReady=function(){l=!0;for(var a in h)h.hasOwnProperty(a)&&m(h[a].data,h[a].source);h=[]}}(jQuery,Formstone)